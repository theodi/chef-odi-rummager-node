language: ruby
rvm:
- 2.0.0
before_script:
- ssh-keygen -f ~/.ssh/id_rsa -t rsa -N ''
- echo 'Host *' >> ~/.ssh/config
- echo "   StrictHostKeyChecking no" >> ~/.ssh/config
- openssl aes-256-cbc -k "$DATA_BAG_KEY" -in test/data_bags/serverdensity/credentials.enc.json -d -a -out test/data_bags/serverdensity/credentials.json
script:
- travis_wait 35 bundle exec rake
after_success:
- openssl enc -d -aes-256-cbc -k $CHEF_KEY -in deploy/key.enc -out deploy/key.pem
- chmod 600 deploy/key.pem
- bundle exec berks install
- "[ \"$TRAVIS_BRANCH\" == \"master\" ] && [ \"$TRAVIS_PULL_REQUEST\" == \"false\"] && bundle exec rake berkshelf:upload"
env:
  global:
  - KITCHEN_YAML=.kitchen.cloud.yml
  - secure: F9tU2GraqaQUggSKX9JTchacrda6kc1DCVJCV0WYafBezl0mTJy7saTxTpLFya3DDh16reOuNXXpxCwS2AojERfbA2gWDLu9EAT93b2JCNSi/uf9dhAAIGz1q8L0D/gsx3cXBinsB/3CowLFPfWzg/7foytovqkotrsXKeEx3yA=
  - secure: buT+elL0w8CfCU+WBKdnw/4RR0xubC/MlDZWtITL6GhY5GnxRbnE/mNcxHsWmLR8FoCLt31rYSno/tyyY5P/zzaW/Vf+Cov8GQ599CqdisMS3iNn8sIRymHJjfI/GoHHHtYfWTrBfkzu/6o8l60Rxp907rwCkTGwlhTX7lCOWP4=
  - secure: MmsBXFG0a6HeNo3A+WZpCiaOaY1fKYlRc38IdbpU2ON4mat9ZEVvdUBM+i0ggeIbGotQdEOq/XkMC2tB9XAih22UXZ1ToCrbXFyVfYTiCqVvTPsaOyQq0h21FT3MZjX2dBdJ931Dxvoz4ZOTuelJbNYhG4QJzydLajxc/HqE0ew=
  - secure: Exi9xe/uBk5z59rkUPh7OXJsc1gwhbBI4nrWciclomkX5BUJWj/6SkeonGZvZhmU4/Tf20IRw1tz+MSdwYBHJJ5ZS/s191vU/4/7VghG+KV5A+UVYpnib8EYM80eLjNZHm+yt92aKHv4ook7TdFSGAwHS4QVtuv14zMcuP3Bz3A=
